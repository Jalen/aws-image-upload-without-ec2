
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script>
var uploadURL;
$(document).ready(function(){
    console.log("ready");
    

    var form = document.getElementById('file-form');
var fileSelect = document.getElementById('file-select');
var uploadButton = document.getElementById('upload-button');

form.onsubmit = function(event) {
  event.preventDefault();

  // Update button text.
  uploadButton.innerHTML = 'Uploading...';
    if(typeof(fileSelect.files[0].type) == 'undefined'){
        alert("No content type associated with this file, are you sure it's a valid image?")
        return;
    }
    
    console.log(fileSelect.files[0])
    $.post('https://l4ur9byy57.execute-api.eu-west-1.amazonaws.com/test/getsigneds3uploadurl', JSON.stringify({contentType: fileSelect.files[0].type}), function(result){

            if(!result.errorMessage){

                console.log("uploading to "+result.oneTimeUploadUrl)
                destinationURL = result.resultUrl
                
                // Upload
                $.ajax({
                    url: result.oneTimeUploadUrl,
                    type: "PUT",
                    data: fileSelect.files[0],
                    processData: false,
                    contentType: false,
                    success: function(result){

                        console.log(result)
                        uploadButton.innerHTML = "Upload";
                        $('body').append('<img src="'+destinationURL+'"/>')
                    }
                })

            }else{
                    alert(result.errorMessage)
            }
            
    },'json')

      
  
}
})



</script>
<form id="file-form" action="handler.php" method="POST">
  <input type="file" id="file-select" name="photos[]" multiple/>
  <button type="submit" id="upload-button">Upload</button>
</form>